<!DOCTYPE html>
<html lang="az" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Ana Səhifə</title>

    <link rel="icon" type="image/x-icon" th:href="@{/files/owl-11.png}">

    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
          rel="stylesheet">

    <style>
        .search-wrapper {
            max-width: 500px;
            margin: 0 auto;
        }

        #welcomeMessage {
            transition: opacity 0.5s ease;
        }

        body:not(.dark-mode) input.form-control::placeholder {
            color: #6c757d !important;
            opacity: 1;
        }

        body.dark-mode input.form-control::placeholder {
            color: #ffffff !important;
            opacity: 1;
        }
    </style>
</head>

<body>

<th:block th:replace="~{participant/fragments/header}"></th:block>

<div class="container-fluid mt-4" th:if="${participant != null}">
    <div id="welcomeMessage" class="alert alert-success text-center">
        <h4>
            Xoş gəlmisiniz,
            <span th:text="${participant.firstName}">İstifadəçi</span>!
        </h4>
    </div>
</div>

<div class="container-fluid mt-5 pb-5">

    <div class="search-wrapper mb-4">
        <form th:action="@{/}" method="get" class="d-flex">

            <input type="text"
                   name="name"
                   class="form-control"
                   placeholder="Mövzu axtar"
                   th:value="${name}"/>

            <button type="submit" class="btn btn-primary ms-2">
                Axtar
            </button>

            <a th:href="@{/}" class="btn btn-outline-warning ms-2">
                Sıfırla
            </a>

        </form>
    </div>

    <div class="table-responsive" style="min-height: 500px;">
        <table class="table table-bordered table-hover align-middle text-center">

            <thead class="table-dark">
            <tr>
                <th>#</th>
                <th>Mövzu</th>
                <th>Sual sayı</th>
                <th>Əməliyyat</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="topic, iterStat : ${topics}">
                <td th:text="${iterStat.index + 1 + (currentPage * 10)}">1</td>
                <td th:text="${topic.name}">Java</td>
                <td th:text="${topic.questionCount}">0</td>
                <td>
                    <a th:if="${#authorization.expression('isAuthenticated()')}"
                       th:href="@{'/quiz/' + ${topic.id} + '/question'}"
                       class="btn btn-primary btn-sm">
                        Başla
                    </a>

                    <a th:if="${!#authorization.expression('isAuthenticated()')}"
                       th:href="@{/login}"
                       class="btn btn-outline-primary btn-sm">
                        Başla
                    </a>
                </td>
            </tr>

            <tr th:if="${#lists.isEmpty(topics)}">
                <td colspan="4" class="text-center">
                    Heç bir mövzu tapılmadı
                </td>
            </tr>
            </tbody>

        </table>
    </div>

    <nav th:if="${totalPages > 1}" class="mt-3">
        <ul class="pagination justify-content-start">
            <li class="page-item"
                th:classappend="${currentPage == 0} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/(page=${currentPage - 1}, name=${name})}">
                    Əvvəlki
                </a>
            </li>

            <li class="page-item"
                th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                th:classappend="${i == currentPage} ? 'active'">
                <a class="page-link"
                   th:href="@{/(page=${i}, name=${name})}"
                   th:text="${i + 1}">
                </a>
            </li>

            <li class="page-item"
                th:classappend="${currentPage + 1 == totalPages} ? 'disabled'">
                <a class="page-link"
                   th:href="@{/(page=${currentPage + 1}, name=${name})}">
                    Növbəti
                </a>
            </li>
        </ul>
    </nav>

</div>

<th:block th:replace="~{participant/fragments/footer}"></th:block>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    setTimeout(() => {
        const msg = document.getElementById("welcomeMessage");
        if (msg) {
            msg.style.opacity = "0";
            setTimeout(() => msg.remove(), 500);
        }
    }, 2000);
</script>

</body>
</html>